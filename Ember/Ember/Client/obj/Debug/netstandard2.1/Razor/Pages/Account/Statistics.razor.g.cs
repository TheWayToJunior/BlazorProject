#pragma checksum "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "4d610f64ab2d899a68b8a0272f538b8abb80e06f"
// <auto-generated/>
#pragma warning disable 1591
namespace Ember.Client.Pages.Account
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using System.Text;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Ember.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Ember.Client;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Ember.Client.Auth;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Ember.Client.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Ember.Client.Shared.Modal;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Ember.Client.Shared.Main;

#line default
#line hidden
#nullable disable
#nullable restore
#line 20 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Ember.Client.Shared.Main.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 21 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Ember.Client.Shared.Layouts;

#line default
#line hidden
#nullable disable
#nullable restore
#line 22 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Ember.Client.Helpers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 24 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using BlazorComponentUtilities;

#line default
#line hidden
#nullable disable
#nullable restore
#line 25 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Blazored;

#line default
#line hidden
#nullable disable
#nullable restore
#line 26 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Blazored.Modal;

#line default
#line hidden
#nullable disable
#nullable restore
#line 27 "D:\С#\.NET Core\Ember\Ember\Client\_Imports.razor"
using Blazored.Modal.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
using System.Text.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
using System.Net;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
           [Authorize]

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.LayoutAttribute(typeof(AccountLayout))]
    [Microsoft.AspNetCore.Components.RouteAttribute("/account")]
    public partial class Statistics : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
#nullable restore
#line 17 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
 if (account != null)
{

#line default
#line hidden
#nullable disable
            __builder.AddContent(0, "    ");
            __builder.OpenElement(1, "main");
            __builder.AddAttribute(2, "class", "dash-content");
            __builder.AddMarkupContent(3, "\r\n        ");
            __builder.OpenElement(4, "div");
            __builder.AddAttribute(5, "class", "container-fluid");
            __builder.AddMarkupContent(6, "\r\n            ");
            __builder.OpenElement(7, "div");
            __builder.AddAttribute(8, "class", "row dash-row");
            __builder.AddMarkupContent(9, "\r\n                ");
            __builder.OpenElement(10, "div");
            __builder.AddAttribute(11, "class", "col-xl-4");
            __builder.AddMarkupContent(12, "\r\n                    ");
            __builder.OpenElement(13, "div");
            __builder.AddAttribute(14, "class", "stats stats-primary waves-effect");
            __builder.AddAttribute(15, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 23 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
                                                                              () => ShowBindAccount()

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(16, "\r\n                        ");
            __builder.AddMarkupContent(17, "<h3 class=\"stats-title\"> Лицеовой счет </h3>\r\n                        ");
            __builder.OpenElement(18, "div");
            __builder.AddAttribute(19, "class", "stats-content");
            __builder.AddMarkupContent(20, "\r\n                            ");
            __builder.AddMarkupContent(21, "<div class=\"stats-icon\">\r\n                                <i class=\"fas fa-user\"></i>\r\n                            </div>\r\n                            ");
            __builder.OpenElement(22, "div");
            __builder.AddAttribute(23, "class", "stats-data");
            __builder.AddMarkupContent(24, "\r\n                                ");
            __builder.OpenElement(25, "div");
            __builder.AddAttribute(26, "class", "stats-number");
            __builder.AddContent(27, 
#nullable restore
#line 30 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
                                                            account.Number ?? "Не указан"

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(28, "\r\n                                ");
            __builder.OpenElement(29, "div");
            __builder.AddAttribute(30, "class", "stats-change");
            __builder.AddMarkupContent(31, "\r\n                                    ");
            __builder.OpenElement(32, "span");
            __builder.AddAttribute(33, "class", "stats-timeframe");
            __builder.AddContent(34, " ");
            __builder.AddContent(35, 
#nullable restore
#line 32 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
                                                                    account.Address

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(36, " ");
            __builder.CloseElement();
            __builder.AddMarkupContent(37, "\r\n                                ");
            __builder.CloseElement();
            __builder.AddMarkupContent(38, "\r\n                            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(39, "\r\n                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(40, "\r\n                    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(41, "\r\n                ");
            __builder.CloseElement();
            __builder.AddMarkupContent(42, "\r\n                ");
            __builder.OpenElement(43, "div");
            __builder.AddAttribute(44, "class", "col-xl-4");
            __builder.AddMarkupContent(45, "\r\n                    ");
            __builder.OpenElement(46, "div");
            __builder.AddAttribute(47, "class", "stats stats-success waves-effect");
            __builder.AddMarkupContent(48, "\r\n                        ");
            __builder.AddMarkupContent(49, "<h3 class=\"stats-title\"> Оплата </h3>\r\n                        ");
            __builder.OpenElement(50, "div");
            __builder.AddAttribute(51, "class", "stats-content");
            __builder.AddMarkupContent(52, "\r\n                            ");
            __builder.AddMarkupContent(53, "<div class=\"stats-icon\">\r\n                                <i class=\"fas fa-cart-arrow-down\"></i>\r\n                            </div>\r\n                            ");
            __builder.OpenElement(54, "div");
            __builder.AddAttribute(55, "class", "stats-data");
            __builder.AddMarkupContent(56, "\r\n                                ");
            __builder.OpenElement(57, "div");
            __builder.AddAttribute(58, "class", "stats-number");
            __builder.AddContent(59, 
#nullable restore
#line 46 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
                                                            account.Payment

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(60, " руб.");
            __builder.CloseElement();
            __builder.AddMarkupContent(61, "\r\n                                ");
            __builder.AddMarkupContent(62, @"<div class=""stats-change"">
                                    <span class=""stats-percentage"">531,10</span>
                                    <span class=""stats-timeframe""> руб/Гкал</span>
                                </div>
                            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(63, "\r\n                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(64, "\r\n                    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(65, "\r\n                ");
            __builder.CloseElement();
            __builder.AddMarkupContent(66, "\r\n                ");
            __builder.AddMarkupContent(67, @"<div class=""col-xl-4"">
                    <div class=""stats stats-danger"">
                        <h3 class=""stats-title""> Горячая линия </h3>
                        <div class=""stats-content"">
                            <div class=""stats-icon"">
                                <i class=""fas fa-phone""></i>
                            </div>
                            <div class=""stats-data"">
                                <div class=""stats-number"">59-87-76</div>
                            </div>
                        </div>
                    </div>
                </div>
            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(68, "\r\n            ");
            __builder.OpenElement(69, "div");
            __builder.AddAttribute(70, "class", "row");
            __builder.AddMarkupContent(71, "\r\n                ");
            __builder.AddMarkupContent(72, "<div class=\"col-xl-6\">\r\n                    <div class=\"card easion-card\">\r\n                        <div class=\"card-header\">\r\n                            <div class=\"easion-card-icon\">\r\n                                <i class=\"fas fa-chart-bar\"></i>\r\n                            </div>\r\n                            <div class=\"easion-card-title\"> Статистика </div>\r\n                            <div class=\"easion-card-menu\">\r\n                                <div class=\"dropdown show\">\r\n                                    <a class=\"easion-card-menu-link\" href=\"#\" role=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\r\n                                    </a>\r\n                                    <div class=\"dropdown-menu dropdown-menu-right\" aria-labelledby=\"dropdownMenuLink\">\r\n                                        <a class=\"dropdown-item\" href=\"#\">Action</a>\r\n                                        <a class=\"dropdown-item\" href=\"#\">Another action</a>\r\n                                        <a class=\"dropdown-item\" href=\"#\">Something else here</a>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"card-body easion-card-body-chart\" id=\"graph-container\">\r\n                            <canvas id=\"easionChartjsBar\"></canvas>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                ");
            __builder.OpenElement(73, "div");
            __builder.AddAttribute(74, "class", "col-xl-6");
            __builder.AddMarkupContent(75, "\r\n                    ");
            __builder.OpenElement(76, "div");
            __builder.AddAttribute(77, "class", "card easion-card");
            __builder.AddMarkupContent(78, "\r\n                        ");
            __builder.AddMarkupContent(79, @"<div class=""card-header"">
                            <div class=""easion-card-icon"">
                                <i class=""fas fa-bell""></i>
                            </div>
                            <div class=""easion-card-title""> История оплат </div>
                        </div>
                        ");
            __builder.OpenElement(80, "div");
            __builder.AddAttribute(81, "class", "card-body ");
            __builder.AddMarkupContent(82, "\r\n                            ");
            __builder.OpenElement(83, "div");
            __builder.AddAttribute(84, "class", "notifications");
            __builder.AddMarkupContent(85, "\r\n");
#nullable restore
#line 105 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
                                 if (account.PaymentHistories != null)
                                {

                                    

#line default
#line hidden
#nullable disable
#nullable restore
#line 108 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
                                     foreach (var item in account.PaymentHistories.OrderBy(h => h.Date))
                                    {

#line default
#line hidden
#nullable disable
            __builder.AddContent(86, "                                        ");
            __builder.OpenElement(87, "a");
            __builder.AddAttribute(88, "href", "#!");
            __builder.AddAttribute(89, "class", "notification");
            __builder.AddMarkupContent(90, "\r\n                                            ");
            __builder.AddMarkupContent(91, "<div class=\"notification-icon\">\r\n                                                <i class=\"fas fa-inbox\"></i>\r\n                                            </div>\r\n                                            ");
            __builder.OpenElement(92, "div");
            __builder.AddAttribute(93, "class", "notification-text");
            __builder.AddContent(94, 
#nullable restore
#line 114 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
                                                                            item.Payment

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(95, " руб.");
            __builder.CloseElement();
            __builder.AddMarkupContent(96, "\r\n                                            ");
            __builder.OpenElement(97, "span");
            __builder.AddAttribute(98, "class", "notification-time");
            __builder.AddContent(99, 
#nullable restore
#line 115 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
                                                                              (DateTime.Now - item.Date).Days

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(100, " days ago");
            __builder.CloseElement();
            __builder.AddMarkupContent(101, "\r\n                                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(102, "\r\n");
#nullable restore
#line 117 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
                                    }

#line default
#line hidden
#nullable disable
            __builder.AddContent(103, "                                    ");
            __builder.AddMarkupContent(104, "<div class=\"notifications-show-all\">\r\n                                        <a href=\"#!\">Подробнее</a>\r\n                                    </div>\r\n");
#nullable restore
#line 122 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"

                                }
                                else
                                {

#line default
#line hidden
#nullable disable
            __builder.AddContent(105, "                                    ");
            __builder.AddMarkupContent(106, "<a href=\"#!\" class=\"notification\">Нет данных</a>\r\n");
#nullable restore
#line 127 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
                                }

#line default
#line hidden
#nullable disable
            __builder.AddContent(107, "                            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(108, "\r\n                        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(109, "\r\n                    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(110, "\r\n                ");
            __builder.CloseElement();
            __builder.AddMarkupContent(111, "\r\n            ");
            __builder.CloseElement();
            __builder.AddMarkupContent(112, "\r\n        ");
            __builder.CloseElement();
            __builder.AddMarkupContent(113, "\r\n    ");
            __builder.CloseElement();
            __builder.AddMarkupContent(114, "\r\n");
#nullable restore
#line 135 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
}
else
{

#line default
#line hidden
#nullable disable
            __builder.AddContent(115, "    ");
            __builder.AddMarkupContent(116, "<div class=\"d-flex align-items-center justify-content-center\" style=\"height: 80vh;\">\r\n        <div class=\"spinner-border text-info\" role=\"status\">\r\n            <span class=\"sr-only\">Loading...</span>\r\n        </div>\r\n    </div>\r\n");
#nullable restore
#line 143 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
}

#line default
#line hidden
#nullable disable
        }
        #pragma warning restore 1998
#nullable restore
#line 145 "D:\С#\.NET Core\Ember\Ember\Client\Pages\Account\Statistics.razor"
       
    private string email;
    private Account account;
    private HttpStatusCode statusCode;

    protected override async Task OnInitializedAsync()
    {
        var state = await authenticationStateProvider.GetAuthenticationStateAsync();

        email = state.User.Identity.Name;
        await GetAccount();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (account != null && !firstRender)
        {
            await InitChartBar();
        }
    }

    private async Task GetAccount()
    {
        var httpResponse = await httpClient.GetAsync($"api/bindaccount?email={email}");

        if (httpResponse.IsSuccessStatusCode)
        {
            var responsString = await httpResponse.Content.ReadAsStringAsync();

            try
            {
                account = JsonSerializer.Deserialize<Account>(responsString,
                    new JsonSerializerOptions() { PropertyNameCaseInsensitive = true });
            }
            catch (JsonException)
            {
                account = new Account();
            }
        }
        else
        {
            Console.WriteLine(httpResponse.StatusCode);
        }

        statusCode = httpResponse.StatusCode;
    }

    private async Task ShowBindAccount()
    {
        switch (statusCode)
        {
            case HttpStatusCode.NoContent:
                await Show<BindAccount>("Привязать аккаунт");
                break;
            case HttpStatusCode.OK:
                await Show<UnlinkAccount>("Отвязать аккаунт");
                break;
            default:
                Console.WriteLine(statusCode);
                break;
        }
    }

    private async Task Show<T>(string title)
        where T : ComponentBase
    {
        ModalParameters parameters = new ModalParameters();
        parameters.Add(nameof(BindAccount.Email), email);

        var modal = Modal.Show<T>(title, parameters);

        var result = await modal.Result;

        if (result.Cancelled)
        {
            await GetAccount();
        }
    }

    private async Task InitChartBar()
    {
        object weekday = new object();
        var deys = account.PaymentHistories?.Select(h => h.Date);

        if (deys != null)
        {
            weekday = new
            {
                Monday    = GetQuantityDays(deys, DayOfWeek.Monday),
                Tuesday   = GetQuantityDays(deys, DayOfWeek.Tuesday),
                Wednesday = GetQuantityDays(deys, DayOfWeek.Wednesday),
                Thursday  = GetQuantityDays(deys, DayOfWeek.Thursday),
                Friday    = GetQuantityDays(deys, DayOfWeek.Friday),
            };
        }

        await JsRuntime.InitChartBar(weekday);
    }

    private int GetQuantityDays(IEnumerable<DateTime> deys, DayOfWeek day)
    {
        return deys.Where(d => d.DayOfWeek == day).Count();
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IModalService Modal { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JsRuntime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager navigationManager { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private HttpClient httpClient { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private AuthenticationStateProvider authenticationStateProvider { get; set; }
    }
}
#pragma warning restore 1591
